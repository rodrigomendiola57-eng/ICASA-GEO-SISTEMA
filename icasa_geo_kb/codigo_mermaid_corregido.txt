graph TD
    %% Estilos de los nodos
    classDef inicio fill:#2ecc71,stroke:#27ae60,stroke-width:2px,color:white;
    classDef proceso fill:#3498db,stroke:#2980b9,stroke-width:2px,color:white;
    classDef documento fill:#f1c40f,stroke:#f39c12,stroke-width:2px,color:black;
    classDef decision fill:#e74c3c,stroke:#c0392b,stroke-width:2px,color:white;
    classDef fin fill:#95a5a6,stroke:#7f8c8d,stroke-width:2px,color:white;

    %% --- FASE 1: COMERCIAL Y SOLICITUD ---
    subgraph FASE_1 ["Fase 1: Solicitud y Contratación"]
        A([Inicio: Cliente solicita servicio]):::inicio --> B[Cotización del flete]:::proceso
        B --> C{¿Cliente Acepta?}:::decision
        C -->|No| Z([Fin del Proceso]):::fin
        C -->|Sí| D[Confirmación y Booking]:::proceso
    end

    %% --- FASE 2: DOCUMENTACIÓN Y DESPACHO ---
    subgraph FASE_2 ["Fase 2: Documentación y Carta Porte"]
        E[Recopilación de Datos Fiscales y de Carga]:::proceso
        F[Emisión de Contrato de Servicio]:::documento
        G[Generación de CARTA PORTE]:::documento
        G1[Validación SAT / Autoridad]:::proceso
        H[Asignación de Seguro de Carga]:::documento
        
        E --> F
        F --> G
        G --> G1
        G1 --> H
    end

    %% --- FASE 3: OPERATIVA Y TRÁNSITO ---
    subgraph FASE_3 ["Fase 3: Recolección y Transporte"]
        I[Asignación de Unidad y Operador]:::proceso
        J[Unidad se dirige a Origen]:::proceso
        K[Llegada a Recolección]:::proceso
        L[Carga y Estiba de Mercancía]:::proceso
        M[Validación Física vs Documental]:::proceso
        N[Inicio de Ruta / Despacho]:::proceso
        O[Tránsito y Monitoreo GPS]:::proceso
        O1[Protocolo de Seguridad]:::decision
        P[Arribo a Destino]:::proceso
        
        I --> J
        J --> K
        K --> L
        L --> M
        M --> N
        N --> O
        O -->|Incidencia| O1
        O -->|Normal| P
        O1 --> P
    end

    %% --- FASE 4: ENTREGA Y CIERRE ---
    subgraph FASE_4 ["Fase 4: Entrega y Cobranza"]
        Q[Maniobras de Descarga]:::proceso
        R[Inspección de Recibo]:::proceso
        S[Firma de POD - Prueba de Entrega]:::documento
        T[Liberación de Unidad]:::proceso
        U[Retorno de Evidencias a Base]:::proceso
        V[Facturación Final]:::documento
        W([Fin: Cobranza y Cierre]):::fin
        
        Q --> R
        R --> S
        S --> T
        T --> U
        U --> V
        V --> W
    end

    %% Conexiones entre fases
    D --> E
    H --> I
    P --> Q